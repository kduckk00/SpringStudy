# CLASS 04 JoinPoint와 바인드 변수

## 4.1 JoinPoint 메소드

  횡단 관심에 해당하는 어드바이스 메소드를 의미 있게 구현하려면 클라이언트가 호출한 비즈니스 메소드의 정보가 필요하다. 예를 들어, After Throwing 기능의 어드바이스 메소드를 구현한다고 가정할 때 예외가 발생한 비즈니스 메소드 이름이 무엇인지, 그 메소드가 속한 클래스와 패키지 정보는 무엇인지 알아야 정확한 예외 처리 로직을 구현할 수 있다.

| 메소드                   | 설명                                                         |
| ------------------------ | ------------------------------------------------------------ |
| Signature getSignature() | 클라이언트가 호출한 메소드의 시그니처(리턴타입, 이름, 매개변수) 정보가 저장된 Signature 객체 리턴 |
| Object getTarget()       | 클라이언트가 호출한 비즈니스 메소드를 포함하는 비즈니스 객체 리턴 |
| Object[] getArgs()       | 클라이언트가 메소드를 호출할 때 넘겨준 인자 목록을 Object 배열로 리턴 |



Before, After Returning, After Throwing, After 어드바이스에서는 Joinpoint를 사용해야 하고, 유일하게 Around 어드바이스에서만 ProceedingJoinPoint를 매개변수로 사용해야한다.

| 메소드명               | 설명                                                         |
| ---------------------- | ------------------------------------------------------------ |
| String getName()       | 클라이언트가 호출한 메소드 이름 리턴                         |
| String toLongString()  | 클라이언트가 호출한 메소드의 리턴타입, 이름, 매개변수를 패키지 경로까지 포함하여 리턴 |
| String toShortSrting() | 클라이언트가 호출한 메소드 시그니처를 축약한 문자열로 리턴   |



JoinPoint 객체를 사용하려면 단지 JoinPoint를 어드바이스 메소드 매개변수로 선언만 하면 된다. 그러면 클라이언트가 비즈니스 메소드를 호출할 떄, 스프링 컨테이너가 JoinPoint 객체를 생성한다. 그리고 메소드 호출과 관련된 모드 정보를 JoinPoint 객체에 저장하여 어드바이스 메소드를 호출할 떄 인자로 넘겨준다.



## 4.2 Before 어드바이스

   Before 어드바이스는 비즈니스 메소드가 실행되기 전에 동작할 로직을 구현한다. 따라서 호출된 메소드 시그니처만 알 수 있으면 다양한 사전 처리 로직을 구현할 수 있다.
   JoinPoint 객체의 getSignature() 메소드를 이용하면, 클라이언트가 호출한 메소드 이름을 출력할 수 있다. 그리고 getArgs() 메소드를 통해 인자 목록을 Object 배열로 얻어낼 수 있어서, 매소드 호출에 어떤 값들을 사용했는지도 알 수 있다.

~~실행결과~~

실행결과를 보면 getUser() 메소드가 호출되었고, 이때 UserVO 객체가 인자로 전달된 것을 확인할 수 있다. 그리고 UserVO객체에 설정된 아이디와 비밀번호 정보를 확인할 수 있다.



## 4.3 After Returning 어드바이스

  After Returning은 비즈니스 메소드가 수행되고 나서, 결과 데이터를 리턴할 떄 동작하는 어드바이스이다. 따라서 어떤 메소드가 어떤 값을 리턴했는지를 알아야 사후 처리 기능을 다양하게 구현할 수 있다.

바인트 변수는 비즈니스 메소드가 리턴한 결괏값을 바인딩할 목적으로 사용하며, 어떤 값이 리턴될지 모르기 때문에 Object 타입으로 선언한다.

After Returning 어드바이스 메소드에 JoinPoint만 선언되어 있다면 스프링 설정 파일은 수정하지 않아도 된다. 하지만 바인드 변수가 추가됐다면 반드시 바인드 변수에 대한 매핑 설정을 스프링 설정 파일에 추가해야 한다. 이때 < aop:after-returning > 엘리먼트의 returning 속성을 사용한다.

관리자 권한을 가진 test 계정으로 로그인을 성공하면 다음처럼 "관리자 로그인(Admin)"이 추가로 출력되고, 일반인 사용자인 userl로 로그인했다면 "관리자 로그인(Admin)"은 출력되지 않는다.

~~실행결과~~



## 4.4 After Throwing 어드바이스

  After Throwing은 비즈니스 메소드가 수행되다가 예외가 발생할 떄 동작하는 어드바이스이다. 따라서 어떤 메소드에서 어떤 예외가 발생했는지 알아야한다.

  exceptionLog()메소드는 예외가 발생한 메소드 정보를 알아내기 위해서 JoinPoint 객체를 매개변수로 받는다. 그리고 After Returning 처럼 비즈니스 메소드에서 발생한 에외 객체를 exceptObj 라는 바인드 변수를 통해 받는다. 바인드 변수는 모든 예외 객체를 바인드할 수 있도록 예외 클래스의 최상위 타입인 Exception으로 선언한다.

After Throwing 어드바이스 메소드에 JoinPoint만 선언되어 있다면 스프링 설정 파일은 수정하지 않아도 된다. 하지만 바인드 변수가 추가됐다면 반드시 바인드 변수에 대한 매핑 설정을 스프링 설정 파일에 추가해야 한다. 이때 < aop:after-throwing > 엘리먼트의 throwing 속성을 사용한다.

After Throwing 어드바이스는 예외가 발생하지 않으면 동작하지 않으므로, 반드시 BoardServiceImpl 클래스에서 이전에 작성한 예외 발생 코드의 주석을 해제하고 확인하기 바란다.



## 4.5 Around 어드바이스

  Aroud 어드바이스는 다른 어드바이스와는 다르게 반드시 ProceedingJoinPoint 객체를 매개변수로 받아야 한다. ProceedingJoinPoint 객체를 매개변수로 받아야 한다. ProceedingJoinPoint 객체는 비즈니스 메소드를 호출하는 proceed() 메소드를 가지고 있으며 JoinPoint를 상속했다.





